import{r as a,j as e,A as ge,i as pe,e as je,d as be,L as Se,b as Me,E as ye,O as we,l as ke,n as ve,B as P,C as y,S as J,p as fe,a as Re,u as xe,Y as Ce,z as re,$ as Pe,m as I,V as n,a3 as Ee,a4 as Le,T as O,a0 as Ne,a1 as me,h as We,a2 as $e,f as Ae}from"./index-FleCPmMf.js";import{u as Te,V as Fe,a as Be,D as De,S as Ve}from"./useHeartbeatSound-ZuqifI76.js";import{P as ze}from"./play-ClWIrPCM.js";const ue=[{label:"Cold (15°C)",value:15,hr:18,amplitude:1.3,color:"#3b82f6",bgColor:"bg-blue-600",borderColor:"border-blue-400"},{label:"Normal (25°C)",value:25,hr:24,amplitude:1,color:"#22c55e",bgColor:"bg-green-600",borderColor:"border-green-400"},{label:"Warm (35°C)",value:35,hr:36,amplitude:.7,color:"#ef4444",bgColor:"bg-red-600",borderColor:"border-red-400"}];function te(i,c){const t=ue.find(k=>k.value===i)||ue[1],o=c==="heart-block"?36:t.hr,p=60/o*1e3;return{hr:o,amplitude:t.amplitude,periodMs:p,color:t.color}}function _e(i,c,t=0,o="extra-systole"){const p=m=>(1-Math.cos(m*Math.PI))/2,k=m=>m<.16?3-2*p(m/.16):m<.32?1+1*p((m-.16)/.16):m<.4?2:m<.56?2-2*p((m-.4)/.16):3*p((m-.56)/.44);let x;if(o==="extra-systole")if(t===2)i<.16?x=3-5*p(i/.16):i<.32?x=-2+5*p((i-.16)/.16):(i<.4||i<.56,x=3);else{x=k(i);const m={3:1/3,4:5/9,5:7/9,6:1};if(t in m){const w=m[t];x=3-(3-x)*w}}else if(o==="staircase"){const m={0:.4,1:.6,2:.8,3:.9};x=k(i);const w=m[t]??1;x=3-(3-x)*w}else o==="summation"?t>=1&&t<=3||t>=6?x=3:x=k(i):o==="heart-block"?t>=4&&t<=7||t>=12&&t<=15?x=3:x=k(i):o==="all-or-none"?(t===0||i<0?x=3:x=k(i),t===0&&i>=0&&i<.02&&(x-=.6)):x=k(i);return x*c}const A=({label:i,children:c,onHoverChange:t})=>e.jsx("group",{onPointerOver:o=>{t&&(o.stopPropagation(),t(i),document.body.style.cursor="pointer")},onPointerOut:()=>{t&&(t(null),document.body.style.cursor="auto")},children:c}),Ie=({onHoverChange:i})=>e.jsx(A,{label:"Myograph Board",onHoverChange:i,children:e.jsxs("group",{position:[0,-.9,0],children:[e.jsx(P,{args:[4,.15,2.5],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#8B7355",roughness:.8})}),e.jsx(P,{args:[3.6,.05,2.1],position:[0,.1,0],children:e.jsx("meshStandardMaterial",{color:"#D2B48C",roughness:.9})}),[[-1.7,-.2,-1],[1.7,-.2,-1],[-1.7,-.2,1],[1.7,-.2,1]].map((c,t)=>e.jsx(y,{args:[.06,.08,.3],position:c,children:e.jsx("meshStandardMaterial",{color:"#5C4033",roughness:.7})},`leg-${t}`)),[[-1.2,.15,-.6],[-1.2,.15,.6],[1.2,.15,-.6],[1.2,.15,.6],[-.6,.15,-.8],[-.6,.15,.8],[.6,.15,-.8],[.6,.15,.8]].map((c,t)=>e.jsxs("group",{position:c,children:[e.jsx(y,{args:[.015,.015,.15],position:[0,.075,0],children:e.jsx("meshStandardMaterial",{color:"#c0c0c0",metalness:.9,roughness:.1})}),e.jsx(J,{args:[.02,8,8],position:[0,.15,0],children:e.jsx("meshStandardMaterial",{color:"#e0e0e0",metalness:.8,roughness:.2})})]},`pin-${t}`))]})}),Xe=({contraction:i,temperature:c,onHoverChange:t,showLigature1:o,isTight1:p,showLigature2:k,isTight2:x})=>{const m=a.useRef(null),w=a.useRef(null),L=a.useRef(null),h=a.useRef(null),l=a.useRef(null),s=a.useRef(null),F=a.useRef(null),B=a.useRef(null),T=a.useMemo(()=>c<=15?"#8B0000":c>=35?"#FF4444":"#be123c",[c]),ee=a.useMemo(()=>new Re(T).multiplyScalar(.8).getHexString(),[T]);xe(()=>{if(w.current){const u=3-i,r=Math.max(.4,1-u*.05),v=Math.max(.5,1-u*.05);if(w.current.scale.set(r,v,r),s.current){const Y=-.3*v;s.current.position.set(0,Y,.05*r),s.current.scale.set(r,1,r)}const $=Math.max(.8,1-u*.04);F.current&&F.current.scale.set($,$,$),B.current&&B.current.scale.set($*(p?.9:1.05),$*(p?.9:1.05),1)}if(L.current&&h.current&&(L.current.scale.set(1,1,1),h.current.scale.set(1,1,1)),l.current){const r=1+(3-i)*.05;l.current.scale.set(r,1,r)}});const f=a.useMemo(()=>{const u=new Ce([new re(0,-.6),new re(.15,-.4),new re(.28,-.1),new re(.32,.2),new re(.25,.5),new re(.15,.6),new re(0,.65)]),r=new Pe(u.getPoints(20),32);return r.computeVertexNormals(),r},[]),oe=a.useMemo(()=>new I([new n(0,.6,.1),new n(0,.85,.15)]),[]),ne=a.useMemo(()=>new I([new n(0,.85,.15),new n(-.25,1,.05),new n(-.4,1.05,-.1)]),[]),q=a.useMemo(()=>new I([new n(0,.85,.15),new n(.25,1,.05),new n(.4,1.05,-.1)]),[]),z=.18,N=.18,b=.12,d=.3,W=0,ae=a.useMemo(()=>new I([new n(-.4,.6,.1),new n(-.3,.4,.15),new n(-z,W+N-.05,d)]),[]),H=a.useMemo(()=>new I([new n(.4,.6,.1),new n(.3,.4,.15),new n(z,W+N-.05,d)]),[]),ie=a.useMemo(()=>new I([new n(0,W-N+.05,d),new n(0,-.6,.1),new n(0,-.7,.1)]),[]),Z=a.useMemo(()=>{const u=new Ee,r=z,v=N,$=b;u.moveTo(-r+$,-v),u.lineTo(r-$,-v),u.quadraticCurveTo(r,-v,r-.06,-v+.1),u.lineTo(.06,v-.1),u.quadraticCurveTo(0,v,-.06,v-.1),u.lineTo(-r+.06,-v+.1),u.quadraticCurveTo(-r,-v,-r+$,-v);const Y={depth:.08,bevelEnabled:!0,bevelSegments:8,steps:2,bevelSize:.05,bevelThickness:.05},D=new Le(u,Y);return D.center(),D},[]),le=a.useMemo(()=>{const u=z+.08,r=N+.08,v=[new n(0,-r,0),new n(u-.1,-r,0),new n(u,-r+.1,0),new n(u-.05,0,0),new n(0,r+.02,0),new n(-.21000000000000002,0,0),new n(-u,-r+.1,0),new n(-.16,-r,0)];return new I(v,!0)},[]),S=a.useMemo(()=>new I([new n(0,N+.08,0),new n(.08,N+.18,.1),new n(.12,N+.28,.15)]),[]),_=a.useMemo(()=>new I([new n(0,N+.08,0),new n(-.08,N+.18,.1),new n(-.12,N+.28,.15)]),[]),ce=a.useMemo(()=>new I([new n(.21,0,0),new n(.35,.1,.05),new n(.4,.2,.1)]),[]),K=a.useMemo(()=>new I([new n(.21,0,0),new n(.35,-.1,.05),new n(.4,-.2,.1)]),[]);return e.jsx(A,{label:"Frog Heart (Sinus Venosus → Atria → Ventricle)",onHoverChange:t,children:e.jsxs("group",{ref:m,position:[0,-.2,0],rotation:[0,0,Math.PI],children:[e.jsxs("group",{position:[0,.55,0],children:[e.jsx("group",{ref:h,position:[.18,0,-.05],rotation:[0,0,-.2],children:e.jsx(A,{label:"Right Atrium",onHoverChange:t,children:e.jsx(J,{args:[.22,32,32],scale:[1,1.1,.9],children:e.jsx("meshPhysicalMaterial",{color:"#"+ee,roughness:.4,metalness:.1,clearcoat:1,clearcoatRoughness:.2})})})}),e.jsx("group",{ref:L,position:[-.18,.05,-.05],rotation:[0,0,.2],children:e.jsx(A,{label:"Left Atrium",onHoverChange:t,children:e.jsx(J,{args:[.16,32,32],scale:[1,1.1,.9],children:e.jsx("meshPhysicalMaterial",{color:"#"+ee,roughness:.4,metalness:.1,clearcoat:1,clearcoatRoughness:.2})})})})]}),e.jsx("group",{ref:w,position:[0,0,.05],children:e.jsx(A,{label:"Ventricle",onHoverChange:t,children:e.jsx("mesh",{geometry:f,children:e.jsx("meshPhysicalMaterial",{color:T,roughness:.5,metalness:.1,clearcoat:1,clearcoatRoughness:.3})})})}),e.jsx("group",{ref:l,children:e.jsxs(A,{label:"Truncus Arteriosus (Branching)",onHoverChange:t,children:[e.jsx(O,{args:[oe,16,.06,12,!1],children:e.jsx("meshPhysicalMaterial",{color:"#d64949",roughness:.4,clearcoat:1})}),e.jsx(O,{args:[ne,16,.045,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#d64949",roughness:.4,clearcoat:1})}),e.jsx(O,{args:[q,16,.045,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#d64949",roughness:.4,clearcoat:1})})]})}),e.jsxs(A,{label:"Vena Cavae",onHoverChange:t,children:[e.jsx(O,{args:[ae,12,.035,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#5e4b8b",roughness:.6})}),e.jsx(O,{args:[H,12,.035,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#5e4b8b",roughness:.6})}),e.jsx(O,{args:[ie,12,.035,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#5e4b8b",roughness:.6})})]}),e.jsx(A,{label:"Sinus Venosus (Posterior)",onHoverChange:t,children:e.jsx("mesh",{ref:F,geometry:Z,position:[0,W,d],rotation:[0,0,Math.PI],children:e.jsx("meshPhysicalMaterial",{color:"#4a2c2c",roughness:.8})})}),o&&e.jsx(A,{label:"1st Stannius Ligature",onHoverChange:t,children:e.jsxs("group",{ref:B,position:[0,W,d],rotation:[0,0,Math.PI],children:[e.jsx(O,{args:[le,64,p?.025:.035,8,!0],scale:[p?.9:1.05,p?.9:1.05,1],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})}),e.jsx(J,{args:[.05,8,8],position:[0,N+.08,0],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})}),e.jsx(O,{args:[S,12,.025,6,!1],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})}),e.jsx(O,{args:[_,12,.025,6,!1],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})})]})}),k&&e.jsx(A,{label:"2nd Stannius Ligature",onHoverChange:t,children:e.jsxs("group",{ref:s,position:[0,-.3,.05],children:[e.jsx(fe,{args:[.2,.03,8,24],rotation:[Math.PI/2,0,0],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})}),e.jsx(J,{args:[.05,8,8],position:[.21,0,0],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})}),e.jsx(O,{args:[ce,12,.02,6,!1],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})}),e.jsx(O,{args:[K,12,.02,6,!1],children:e.jsx("meshStandardMaterial",{color:"#ffffff",roughness:.9})})]})})]})})},Ge=({onHoverChange:i})=>e.jsx(A,{label:"Frog (Pithed)",onHoverChange:i,children:e.jsxs("group",{position:[0,-.4,.2],rotation:[-.1,0,0],children:[e.jsx(J,{args:[.5,32,32],scale:[2.2,1,3],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsxs("group",{position:[0,.45,-.5],rotation:[.1,0,0],children:[e.jsx(fe,{args:[.28,.05,16,24],rotation:[Math.PI/2,0,0],scale:[1,1,1.2],position:[0,.02,0],children:e.jsx("meshStandardMaterial",{color:"#661111",roughness:.5})}),e.jsxs("group",{position:[-.4,.02,0],rotation:[0,0,.3],children:[e.jsx(P,{args:[.3,.03,.6],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(P,{args:[.28,.031,.58],position:[.05,-.005,0],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]}),e.jsxs("group",{position:[.4,.02,0],rotation:[0,0,-.3],children:[e.jsx(P,{args:[.3,.03,.6],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(P,{args:[.28,.031,.58],position:[-.05,-.005,0],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]}),e.jsxs("group",{position:[0,.05,-.4],rotation:[.4,0,0],children:[e.jsx(P,{args:[.5,.03,.25],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(P,{args:[.48,.031,.23],position:[0,-.005,.05],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]}),e.jsxs("group",{position:[0,.05,.4],rotation:[-.4,0,0],children:[e.jsx(P,{args:[.5,.03,.25],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(P,{args:[.48,.031,.23],position:[0,-.005,-.05],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]})]}),e.jsxs("group",{position:[0,.1,-1.6],children:[e.jsx(J,{args:[.4,32,32],scale:[1.5,.8,1.2],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(J,{args:[.1,16,16],position:[.3,.2,-.1],children:e.jsx("meshStandardMaterial",{color:"#111",roughness:.2})}),e.jsx(J,{args:[.1,16,16],position:[-.3,.2,-.1],children:e.jsx("meshStandardMaterial",{color:"#111",roughness:.2})})]}),e.jsx("group",{position:[.9,-.1,1],rotation:[0,.5,0],children:e.jsx(y,{args:[.2,.15,1.2],rotation:[0,0,1.2],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})})}),e.jsx("group",{position:[-.9,-.1,1],rotation:[0,-.5,0],children:e.jsx(y,{args:[.2,.15,1.2],rotation:[0,0,-1.2],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})})}),e.jsx("group",{position:[.8,-.1,-.8],rotation:[0,-.3,0],children:e.jsx(y,{args:[.12,.1,1],rotation:[0,0,1.3],children:e.jsx("meshStandardMaterial",{color:"#8da399",roughness:.8})})}),e.jsx("group",{position:[-.8,-.1,-.8],rotation:[0,.3,0],children:e.jsx(y,{args:[.12,.1,1],rotation:[0,0,-1.3],children:e.jsx("meshStandardMaterial",{color:"#8da399",roughness:.8})})})]})}),Oe=({length:i,radius:c,coils:t,color:o,thickness:p})=>{const x=a.useMemo(()=>{const m=[],w=t*12;for(let h=0;h<=w;h++){const l=h/w,s=l*Math.PI*2*t,F=c*Math.cos(s),B=c*Math.sin(s),T=-l*1;m.push(new n(F,T,B))}const L=new I(m);return new $e(L,w,p,8,!1)},[c,t,p]);return e.jsx("group",{scale:[1,i/1,1],children:e.jsx("mesh",{geometry:x,children:e.jsx("meshStandardMaterial",{color:o,metalness:.6,roughness:.4})})})},Ue=({angle:i,onHoverChange:c})=>{const t="#e2e8f0",o="#94a3b8",p="#475569",k="#f1f5f9",w=[-1.5,.7,.15],L=-i,l=.75+i*.9,s=[.6,0,0];return e.jsxs("group",{position:[0,.5,.5],children:[e.jsx(A,{label:"Starling Lever (Stand Post)",onHoverChange:c,children:e.jsx(y,{args:[.06,.06,4.5],position:[-1.5,0,0],children:e.jsx("meshStandardMaterial",{color:o,metalness:.6,roughness:.4})})}),e.jsx(A,{label:"Starling Lever (Tension Adjuster)",onHoverChange:c,children:e.jsxs("group",{position:[-.75,.4,0],rotation:[0,0,1.57],children:[e.jsx(y,{args:[.025,.025,1],position:[.8,.05,0],rotation:[0,0,Math.PI/2],children:e.jsx("meshStandardMaterial",{color:t,metalness:.6})}),e.jsxs("group",{position:[1.1,.05,0],children:[e.jsx(P,{args:[.1,.15,.1],children:e.jsx("meshStandardMaterial",{color:t})}),e.jsx(y,{args:[.015,.015,.6],position:[0,-.17,0],children:e.jsx("meshStandardMaterial",{color:t,metalness:.5})}),e.jsx(y,{args:[.05,.05,.04],position:[0,.13,0],children:e.jsx("meshStandardMaterial",{color:p,roughness:.8})}),e.jsx(fe,{args:[.025,.005,8,16],position:[0,-.47,0],rotation:[Math.PI/2,0,0],children:e.jsx("meshStandardMaterial",{color:t})})]})]})}),e.jsxs("group",{position:w,children:[e.jsxs("group",{position:[.3,0,-.14],children:[e.jsx(A,{label:"Starling Lever (Mounting Clamp)",onHoverChange:c,children:e.jsxs("group",{children:[e.jsx(P,{args:[.85,.13,.4],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})}),e.jsxs("group",{position:[-.5,0,0],rotation:[0,0,Math.PI/2],children:[e.jsx(y,{args:[.03,.03,.1],children:e.jsx("meshStandardMaterial",{color:p})}),e.jsx(y,{args:[.07,.07,.02],position:[0,.05,0],children:e.jsx("meshStandardMaterial",{color:p})})]})]})}),e.jsxs("group",{position:[.55,0,0],children:[e.jsx(P,{args:[.05,.13,.35],position:[-.1,0,0],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})}),e.jsx(P,{args:[.25,.13,.04],position:[0,0,.18],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})}),e.jsx(P,{args:[.25,.13,.04],position:[0,0,-.18],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})})]}),e.jsxs("group",{rotation:[0,0,L],position:s,children:[e.jsx(y,{args:[.02,.02,.35],rotation:[Math.PI/2,0,0],children:e.jsx("meshStandardMaterial",{color:p})}),e.jsx(A,{label:"Starling Lever (Lever Arm)",onHoverChange:c,children:e.jsxs("group",{position:[.5,0,0],children:[e.jsx(P,{args:[1.2,.12,.03],children:e.jsx("meshStandardMaterial",{color:k,roughness:.3,metalness:.2})}),[-.4,-.2,0,.2,.4].map((F,B)=>e.jsx("group",{position:[F,0,0],rotation:[Math.PI/2,0,0],children:e.jsx(y,{args:[.025,.025,.032],children:e.jsx("meshBasicMaterial",{color:"#1e293b"})})},B))]})}),e.jsx(A,{label:"Starling Lever (Writing Stylus)",onHoverChange:c,children:e.jsxs("group",{position:[1.18,0,0],children:[e.jsx(P,{args:[.08,.08,.08],position:[-.04,0,0],children:e.jsx("meshStandardMaterial",{color:t})}),e.jsx(y,{args:[.012,.012,2.9],position:[1.45,0,0],rotation:[0,0,Math.PI/2],children:e.jsx("meshStandardMaterial",{color:"#222",roughness:.6})}),e.jsx(me,{args:[.012,.06,8],position:[2.9,0,0],rotation:[0,0,-Math.PI/2],children:e.jsx("meshStandardMaterial",{color:"#111"})})]})})]})]}),e.jsx(A,{label:"Starling Lever (Spring)",onHoverChange:c,children:e.jsx("group",{position:[1.15,.8,-.15],children:e.jsx(Oe,{length:l,radius:.04,coils:14,color:"#cbd5e1",thickness:.01})})})]})]})},Ye=({contraction:i})=>{const{start:t,end:o,len:p,midpoint:k,quaternion:x}=a.useMemo(()=>{const s=-((3-i)*.036),F=1.16+Math.sin(s)*1,B=new n(0,.06-(3-i)*.03,0),T=new n(0,F,0),ee=B.distanceTo(T),f=new n().addVectors(B,T).multiplyScalar(.5),oe=new n(0,1,0),ne=new n().subVectors(T,B).normalize(),q=new Ne().setFromUnitVectors(oe,ne);return{start:B,end:T,len:ee,midpoint:f,quaternion:q}},[i]),m=a.useMemo(()=>new I([new n(0,-.015,0),new n(0,-.12,0),new n(-.01,-.14,0),new n(-.04,-.14,0),new n(-.05,-.1,0)]),[]);return e.jsxs("group",{position:[0,.1,.5],children:[e.jsxs("mesh",{position:k,quaternion:x,scale:[1,p,1],children:[e.jsx("cylinderGeometry",{args:[.003,.003,1,8]}),e.jsx("meshStandardMaterial",{color:"#f0f0f0",roughness:.5})]}),e.jsxs("group",{position:t,rotation:[0,0,.1],children:[e.jsx(fe,{args:[.015,.003,8,16],rotation:[0,Math.PI/2,0],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})}),e.jsx(O,{args:[m,32,.003,8,!1],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})}),e.jsx(y,{args:[.001,.003,.02],position:[-.052,-.09,0],rotation:[0,0,-.2],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})}),e.jsx(me,{args:[.002,.01,8],position:[-.052,-.1,0],rotation:[0,0,2.8],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})})]})]})},qe=({simTime:i,waveformValue:c,isRecording:t,onHoverChange:o,resetKey:p,drumSpeed:k})=>{const x=a.useRef(document.createElement("canvas")),m=a.useRef(null),w=a.useMemo(()=>{const h=x.current;h.width=2048,h.height=512;const l=h.getContext("2d");if(l){l.fillStyle="#1a1a1a",l.fillRect(0,0,2048,512),l.fillStyle="#0d0d0d";for(let s=0;s<200;s++)l.fillRect(Math.random()*2048,Math.random()*512,Math.random()*4,Math.random()*4)}return new We(h)},[]);a.useEffect(()=>{const h=x.current.getContext("2d");if(h){h.fillStyle="#1a1a1a",h.fillRect(0,0,2048,512),h.fillStyle="#0d0d0d";for(let l=0;l<200;l++)h.fillRect(Math.random()*2048,Math.random()*512,Math.random()*4,Math.random()*4);w.needsUpdate=!0}m.current=null},[p,w]),xe(()=>{if(!t){m.current=null;return}const h=x.current.getContext("2d");if(!h)return;const s=80+i/1e3*k*15,F=512*.5-c*30;m.current&&(h.strokeStyle="#ffffff",h.lineWidth=2.5,h.shadowColor="#ffffff",h.shadowBlur=1,h.beginPath(),h.moveTo(m.current.x,m.current.y),h.lineTo(s,F),h.stroke(),h.shadowBlur=0,w.needsUpdate=!0),m.current={x:s,y:F}});const L=a.useRef(null);return xe(()=>{if(L.current&&t){const s=(80+i/1e3*k*15-80)/2048*(2*Math.PI),F=1.8+Math.PI;L.current.rotation.y=F-s}}),e.jsx(A,{label:"Kymograph Drum",onHoverChange:o,children:e.jsxs("group",{position:[0,0,0],children:[e.jsx("group",{ref:L,rotation:[0,1.8+Math.PI,0],children:e.jsxs(y,{args:[1,1,2.5,64],children:[e.jsx("meshBasicMaterial",{attach:"material-0",map:w}),e.jsx("meshStandardMaterial",{attach:"material-1",color:"#111"}),e.jsx("meshStandardMaterial",{attach:"material-2",color:"#111"})]})}),e.jsx(y,{args:[.06,.06,3.5],position:[0,-.15,0],children:e.jsx("meshStandardMaterial",{color:"#1e293b",metalness:.8})}),e.jsx(P,{args:[1.2,.45,1.5],position:[0,-1.75,0],children:e.jsx("meshStandardMaterial",{color:"#0f172a",metalness:.3,roughness:.6})})]})})},He=({data:i,temperature:c,isRecording:t,selectedExperiment:o,drumSpeed:p,heartRate:k})=>{ue.find(S=>S.value===c)||ue[1];const x="#4ade80",m="#14532d",w="#166534",L="#020617",h=900,l=320,s={top:110,right:20,bottom:40,left:40},F=h-s.left-s.right,B=l-s.top-s.bottom,T=-2.5,ee=3.5,f=S=>s.top+B-(S-T)/(ee-T)*B,q=24e3*(2.5/Math.max(.5,p)),z=i.length>0?i[i.length-1].t:0,N=Math.max(0,z-q),b=Math.max(q,z+200),d=S=>s.left+(S-N)/(b-N)*F,W=i.filter(S=>S.t>=N-500),ae=W.length>1?`M ${W.map(S=>`${d(S.t)},${f(S.y)}`).join(" L ")}`:"",H=[],ie=Math.ceil(N/500)*500,Z=q>6e4?5e3:q>3e4?1e3:500;for(let S=ie;S<=b;S+=Z)H.push(S);const le=[0,1,2,3];return e.jsxs("svg",{viewBox:`0 0 ${h} ${l}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("rect",{x:0,y:0,width:h,height:l,fill:L,rx:8}),e.jsx("pattern",{id:"scanlines",patternUnits:"userSpaceOnUse",width:"4",height:"4",children:e.jsx("line",{x1:"0",y1:"0",x2:"4",y2:"0",stroke:"#000",strokeOpacity:"0.2",strokeWidth:"1"})}),e.jsx("rect",{x:0,y:0,width:h,height:l,fill:"url(#scanlines)",pointerEvents:"none"}),le.map((S,_)=>e.jsx("line",{x1:s.left,y1:f(S),x2:h-s.right,y2:f(S),stroke:S===0?w:m,strokeWidth:1},`hgrid-${_}`)),H.map((S,_)=>e.jsx("line",{x1:d(S),y1:s.top,x2:d(S),y2:l-s.bottom,stroke:S%1e3===0?w:m,strokeWidth:1},`tmark-${_}`)),e.jsxs("defs",{children:[e.jsxs("filter",{id:"oscilloscopeGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),e.jsx("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]}),e.jsx("marker",{id:"arrowAmber",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#f59e0b"})}),e.jsx("marker",{id:"arrowBlue",viewBox:"0 0 10 10",refX:"10",refY:"5",markerWidth:"6",markerHeight:"6",orient:"auto",children:e.jsx("path",{d:"M 0 0 L 10 5 L 0 10 z",fill:"#38bdf8"})})]}),e.jsx("path",{d:ae,fill:"none",stroke:x,strokeWidth:2,filter:"url(#oscilloscopeGlow)"}),(()=>{const S=te(c,o),_=S.periodMs,ce=_*2+_*.16,K=d(ce),u=_*2+_*.7,r=d(u),v=_*3,$=_*7,Y=d(v),D=d($),C=(Y+D)/2;if(i.length===0||t&&o!=="summation")return null;if(o==="extra-systole")return e.jsxs(e.Fragment,{children:[e.jsxs("g",{children:[e.jsx("text",{x:K,y:f(-2)+110,textAnchor:"middle",fill:"#f59e0b",fontSize:24,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:"Extra Systole"}),e.jsx("line",{x1:K,y1:f(-2)+85,x2:K,y2:f(-2)+12,stroke:"#f59e0b",strokeWidth:3}),e.jsx("path",{d:`M ${K-10} ${f(-2)+22} L ${K} ${f(-2)+8} L ${K+10} ${f(-2)+22}`,fill:"none",stroke:"#f59e0b",strokeWidth:3,strokeLinejoin:"round"})]}),e.jsxs("g",{children:[e.jsx("text",{x:r,y:f(3)-90,textAnchor:"middle",fill:"#38bdf8",fontSize:24,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:"Compensatory Pause"}),e.jsx("line",{x1:r,y1:f(3)-65,x2:r,y2:f(3)-10,stroke:"#38bdf8",strokeWidth:3}),e.jsx("path",{d:`M ${r-10} ${f(3)-22} L ${r} ${f(3)-8} L ${r+10} ${f(3)-22}`,fill:"none",stroke:"#38bdf8",strokeWidth:3,strokeLinejoin:"round"})]}),e.jsxs("g",{children:[e.jsx("line",{x1:Y,y1:l-s.bottom+15,x2:D,y2:l-s.bottom+15,stroke:"#c084fc",strokeWidth:3}),e.jsx("line",{x1:Y,y1:l-s.bottom+5,x2:Y,y2:l-s.bottom+25,stroke:"#c084fc",strokeWidth:3}),e.jsx("line",{x1:D,y1:l-s.bottom+5,x2:D,y2:l-s.bottom+25,stroke:"#c084fc",strokeWidth:3}),e.jsx("text",{x:C,y:l-s.bottom+65,textAnchor:"middle",fill:"#c084fc",fontSize:26,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:"Treppe (Staircase)"})]})]});if(o==="summation"){const X=te(c,o).periodMs,U=0,j=X*2,M=X*4,R=d(U),g=l-s.bottom+40,E=[];E.push(0),E.push(j);for(let G=0;G<5;G++)E.push(M-1250+G*250);const Q=E.filter(G=>!t||G<=z),se=t?Math.min(h-s.right,d(z)):h-s.right,de=s.left;return e.jsxs(e.Fragment,{children:[se>de&&e.jsx("line",{x1:de,y1:g,x2:se,y2:g,stroke:"#ef4444",strokeWidth:2}),Q.map((G,he)=>e.jsx("line",{x1:d(G),y1:g-10,x2:d(G),y2:g+10,stroke:"#ef4444",strokeWidth:2},he)),(!t||z>=U)&&e.jsxs("g",{children:[e.jsx("text",{x:R,y:g+100,textAnchor:"start",fill:"#22c55e",fontSize:18,fontFamily:"monospace",fontWeight:"bold",children:"Threshold"}),e.jsx("line",{x1:R+5,y1:g+75,x2:R,y2:g+15,stroke:"#22c55e",strokeWidth:2,strokeDasharray:"4 2"}),e.jsx("path",{d:`M ${R-4} ${g+20} L ${R} ${g+12} L ${R+4} ${g+20}`,fill:"none",stroke:"#22c55e",strokeWidth:2})]}),(!t||z>=j)&&e.jsxs("g",{children:[e.jsx("text",{x:d(j),y:g+100,textAnchor:"middle",fill:"#fbbf24",fontSize:18,fontFamily:"monospace",fontWeight:"bold",children:"Sub-threshold"}),e.jsx("line",{x1:d(j),y1:g+75,x2:d(j),y2:g+15,stroke:"#fbbf24",strokeWidth:2,strokeDasharray:"4 2"}),e.jsx("path",{d:`M ${d(j)-4} ${g+20} L ${d(j)} ${g+12} L ${d(j)+4} ${g+20}`,fill:"none",stroke:"#fbbf24",strokeWidth:2})]}),(!t||z>=M-1250)&&e.jsxs("g",{children:[e.jsx("line",{x1:d(M-1250),y1:g+15,x2:d(M-250),y2:g+15,stroke:"#ef4444",strokeWidth:2}),e.jsx("line",{x1:d(M-1250),y1:g+10,x2:d(M-1250),y2:g+20,stroke:"#ef4444",strokeWidth:2}),e.jsx("line",{x1:d(M-250),y1:g+10,x2:d(M-250),y2:g+20,stroke:"#ef4444",strokeWidth:2}),e.jsx("text",{x:d(M-1250),y:g+40,textAnchor:"start",fill:"#ef4444",fontSize:18,fontFamily:"monospace",fontWeight:"bold",children:"Summation (5 subthreshold)"})]})]})}if(o==="staircase"){const X=_*4,U=d(0),j=d(X),M=(U+j)/2;return e.jsxs("g",{children:[e.jsx("line",{x1:U,y1:l-s.bottom+15,x2:j,y2:l-s.bottom+15,stroke:"#c084fc",strokeWidth:3}),e.jsx("line",{x1:U,y1:l-s.bottom+5,x2:U,y2:l-s.bottom+25,stroke:"#c084fc",strokeWidth:3}),e.jsx("line",{x1:j,y1:l-s.bottom+5,x2:j,y2:l-s.bottom+25,stroke:"#c084fc",strokeWidth:3}),e.jsx("text",{x:M,y:l-s.bottom+65,textAnchor:"middle",fill:"#c084fc",fontSize:26,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:"Treppe (Staircase)"})]})}if(o==="heart-block"){const j=d(9999.5),g=(23333+33333)/2,E=d(g);return e.jsxs(e.Fragment,{children:[e.jsxs("g",{children:[e.jsx("text",{x:j,y:f(3)-130,textAnchor:"middle",fill:"#f59e0b",fontSize:24,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:"1st Stannius Ligature"}),e.jsx("line",{x1:j,y1:f(3)-105,x2:j,y2:f(3)-12,stroke:"#f59e0b",strokeWidth:3}),e.jsx("path",{d:`M ${j-10} ${f(3)-22} L ${j} ${f(3)-8} L ${j+10} ${f(3)-22}`,fill:"none",stroke:"#f59e0b",strokeWidth:3,strokeLinejoin:"round"})]}),e.jsxs("g",{children:[e.jsx("text",{x:E,y:f(3)-70,textAnchor:"middle",fill:"#38bdf8",fontSize:24,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:"2nd Stannius Ligature"}),e.jsx("line",{x1:E,y1:f(3)-45,x2:E,y2:f(3)-12,stroke:"#38bdf8",strokeWidth:3}),e.jsx("path",{d:`M ${E-10} ${f(3)-22} L ${E} ${f(3)-8} L ${E+10} ${f(3)-22}`,fill:"none",stroke:"#38bdf8",strokeWidth:3,strokeLinejoin:"round"})]}),e.jsx("text",{x:d(3333),y:l-15,textAnchor:"middle",fill:"#a3e635",fontSize:18,fontFamily:"monospace",fontWeight:"bold",children:"36 BPM"}),e.jsx("text",{x:d(18333),y:l-15,textAnchor:"middle",fill:"#a3e635",fontSize:18,fontFamily:"monospace",fontWeight:"bold",children:"24 BPM"}),e.jsx("text",{x:d(45e3),y:l-15,textAnchor:"middle",fill:"#a3e635",fontSize:18,fontFamily:"monospace",fontWeight:"bold",children:"12 BPM"})]})}if(o==="all-or-none"){const V=S.periodMs+4e3,X=["Sub threshold","Threshold","Maximal","Supramaximal"];return e.jsx(e.Fragment,{children:X.map((U,j)=>{const M=d(j*V),R=j%2===1,g=R?35:75,E=R?50:90;return e.jsxs("g",{children:[e.jsx("text",{x:M,y:g,textAnchor:j===0?"start":"middle",fill:"#facc15",fontSize:22,fontFamily:"monospace",fontWeight:"bold",style:{filter:"drop-shadow(0 0 4px rgba(0,0,0,0.8))"},children:U}),e.jsx("line",{x1:j===0?M+10:M,y1:E,x2:j===0?M+10:M,y2:f(3)-12,stroke:"#facc15",strokeWidth:3}),e.jsx("path",{d:`M ${(j===0?M+10:M)-7} ${f(3)-24} L ${j===0?M+10:M} ${f(3)-10} L ${(j===0?M+10:M)+7} ${f(3)-24}`,fill:"none",stroke:"#facc15",strokeWidth:3})]},`all-none-${j}`)})})}return null})(),e.jsxs("text",{x:h-s.right-10,y:s.top+20,textAnchor:"end",fill:x,fontSize:14,fontFamily:"monospace",fontWeight:"bold",children:["HR: ",k," BPM"]}),e.jsxs("text",{x:h-s.right-10,y:s.top+40,textAnchor:"end",fill:w,fontSize:12,fontFamily:"monospace",children:["T: ",c,"°C"]}),t&&e.jsx("text",{x:s.left+10,y:s.top+20,fill:"#ef4444",fontSize:14,fontFamily:"monospace",fontWeight:"bold",children:"● REC"})]})},Ke=({isPressed:i,onHoverChange:c})=>{const t=a.useRef(null);return xe((o,p)=>{if(t.current){const k=i?.05:.2;t.current.rotation.z=Ae.lerp(t.current.rotation.z,k,p*10)}}),e.jsx(A,{label:"Tap Key (Stimulus)",onHoverChange:c,children:e.jsxs("group",{position:[2.8,-.68,.8],rotation:[0,-.2,0],children:[e.jsx(P,{args:[1.4,.12,.7],position:[0,.06,0],children:e.jsx("meshStandardMaterial",{color:"#111",roughness:.2,metalness:.1})}),e.jsxs("group",{position:[-.5,.12,.15],children:[e.jsxs(y,{args:[.05,.05,.02],position:[0,0,0],children:[" ",e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})," "]}),e.jsx(y,{args:[.05,.07,.25],position:[0,.12,0],children:e.jsx("meshStandardMaterial",{color:"#1a1a1a",roughness:.3})}),e.jsxs(y,{args:[.02,.02,.05],position:[0,.26,0],children:[" ",e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})," "]})]}),e.jsxs("group",{position:[.5,.12,.15],children:[e.jsxs(y,{args:[.05,.05,.02],position:[0,0,0],children:[" ",e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})," "]}),e.jsx(y,{args:[.05,.07,.25],position:[0,.12,0],children:e.jsx("meshStandardMaterial",{color:"#1a1a1a",roughness:.3})}),e.jsxs(y,{args:[.02,.02,.05],position:[0,.26,0],children:[" ",e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})," "]})]}),e.jsxs("group",{position:[-.4,.12,-.1],children:[e.jsx(P,{args:[.2,.01,.3],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#c0c0c0",metalness:.8})}),e.jsx(y,{args:[.02,.02,.05],position:[0,.02,0],children:e.jsx("meshStandardMaterial",{color:"#c0c0c0",metalness:.8})}),e.jsxs("group",{ref:t,rotation:[0,0,.2],children:[e.jsx(P,{args:[1.1,.015,.12],position:[.55,0,0],children:e.jsx("meshStandardMaterial",{color:"#e2e8f0",metalness:.7,roughness:.3})}),e.jsxs("group",{position:[1,.01,0],children:[e.jsx(y,{args:[.015,.015,.15],position:[0,.08,0],children:e.jsx("meshStandardMaterial",{color:"#111"})}),e.jsx(y,{args:[.15,.15,.08],position:[0,.16,0],children:e.jsx("meshStandardMaterial",{color:"#111",roughness:.6})}),e.jsx(y,{args:[.02,.02,.06],position:[0,-.04,0],children:e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})})]})]})]}),e.jsxs("group",{position:[.6,.12,-.1],children:[e.jsx(P,{args:[.15,.01,.15],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})}),e.jsx(y,{args:[.03,.03,.06],position:[0,.03,0],children:e.jsx("meshStandardMaterial",{color:"#d4af37",metalness:.8})})]}),e.jsx(O,{args:[new I([new n(-.5,.12,.15),new n(-.6,.12,.3)]),8,.01,8,!1],children:e.jsx("meshStandardMaterial",{color:"#333"})}),e.jsx(O,{args:[new I([new n(.5,.12,.15),new n(.6,.12,.3)]),8,.01,8,!1],children:e.jsx("meshStandardMaterial",{color:"#333"})})]})})},et=({onBack:i})=>{const[c,t]=a.useState(25),[o,p]=a.useState("heart-block"),[k,x]=a.useState(null),[m,w]=a.useState(0),[L,h]=a.useState(2.5),[l,s]=a.useState("3d"),[F,B]=a.useState(!1),[T,ee]=a.useState(!1),[f,oe]=a.useState(0),[ne,q]=a.useState(!1),[z,N]=a.useState("#CBD5E1"),[b,d]=a.useState({time:0,isRecording:!1,data:[],currentContraction:3,heartRate:24,temperature:25}),W=a.useRef(),ae=a.useRef(0),H=a.useRef([]),ie=20,Z=a.useRef(0),le=a.useRef(c),{ensureAudioContext:S}=Te({isRecording:b.isRecording,phase:f,volume:1,muted:T,silent:ne});a.useEffect(()=>{le.current=c},[c]),a.useEffect(()=>{h(o==="heart-block"?1:o==="all-or-none"?1.5:2.5)},[o]);const _=()=>{b.isRecording||(S(),H.current=[],Z.current=0,d({time:0,isRecording:!0,data:[],currentContraction:3,heartRate:te(c,o).hr,temperature:c}),w(u=>u+1),ae.current=0)},ce=()=>{d(u=>({...u,isRecording:!1})),W.current&&cancelAnimationFrame(W.current)},K=()=>{H.current=[],Z.current=0,d({time:0,isRecording:!1,data:[],currentContraction:3,heartRate:te(c,o).hr,temperature:c}),w(u=>u+1),W.current&&cancelAnimationFrame(W.current)};return a.useEffect(()=>{if(!b.isRecording){d($=>({...$,heartRate:te(c,o).hr}));return}let u=Date.now(),r=0;ae.current=Date.now();const v=()=>{const $=Date.now(),Y=$-u;u=$,r+=Y;const D=te(le.current,o);let C=0,V=0,X=D.hr;if(o==="heart-block"){const R=1666.6666666666667,g=8,E=g*R,Q=60/24*1e3,se=8,de=E+se*Q;if(r<E)C=Math.floor(r/R),V=r%R/R,X=36;else if(r<de){const G=r-E;C=g+Math.floor(G/Q),V=G%Q/Q,X=24}else{const he=r-de;C=g+se+Math.floor(he/5e3),V=he%5e3/5e3,X=12}if(C>=25){d(G=>({...G,isRecording:!1}));return}}else if(o==="all-or-none"){const R=D.periodMs,E=R+4e3;C=Math.floor(r/E);const Q=r%E;if(Q<R?V=Q/R:V=-1,C>=4){d(se=>({...se,isRecording:!1}));return}}else{C=Math.floor(r/D.periodMs),V=r%D.periodMs/D.periodMs;let R=10;if(o==="summation"&&(R=5),C>=R){d(g=>({...g,isRecording:!1}));return}}const U=_e(V,D.amplitude,C,o),j=Math.max(0,U);oe(V);let M=!1;o==="heart-block"?M=C>=4&&C<=7||C>=12&&C<=15:o==="summation"?M=C>=1&&C<=3||C>=6:o==="all-or-none"&&(M=C===0||V<0),q(M),r-Z.current>=ie&&(Z.current=r,H.current.push({t:r,y:U})),d(R=>({...R,time:r,currentContraction:j,heartRate:X,data:H.current,ligature1:o==="heart-block"&&C>=4,ligature2:o==="heart-block"&&C>=12})),W.current=requestAnimationFrame(v)};return W.current=requestAnimationFrame(v),()=>{W.current&&cancelAnimationFrame(W.current)}},[b.isRecording]),e.jsxs("div",{className:"flex flex-col h-screen bg-slate-950 text-slate-100 font-sans",children:[e.jsxs("header",{className:"flex items-center justify-between px-6 py-4 bg-slate-900 border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:i,className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400",children:e.jsx(ge,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-red-400 to-pink-500 bg-clip-text text-transparent",children:"Properties of Cardiac Muscle"}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Amphibian / Frog Heart — Effect of Temperature"})]})]}),e.jsx("button",{onClick:()=>N(u=>u==="#CBD5E1"?"#2F3E46":"#CBD5E1"),className:"p-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300 border border-slate-700 transition-colors flex items-center justify-center",title:"Toggle Canvas Background",children:z==="#CBD5E1"?e.jsx(pe,{className:"w-5 h-5"}):e.jsx(je,{className:"w-5 h-5"})})]}),e.jsxs("main",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden",children:[e.jsxs("div",{className:"lg:hidden flex bg-slate-800 border-b border-slate-700",children:[e.jsxs("button",{onClick:()=>s("3d"),className:`flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium transition-all ${l==="3d"?"bg-slate-900 text-red-400 border-b-2 border-red-400":"text-slate-400 hover:text-slate-200"}`,children:[e.jsx(be,{className:"w-4 h-4"}),e.jsx("span",{children:"3D View"})]}),e.jsxs("button",{onClick:()=>s("graph"),className:`flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium transition-all ${l==="graph"?"bg-slate-900 text-red-400 border-b-2 border-red-400":"text-slate-400 hover:text-slate-200"}`,children:[e.jsx(Se,{className:"w-4 h-4"}),e.jsx("span",{children:"Cardiogram"})]})]}),e.jsxs("div",{className:`flex-1 relative bg-black ${l==="graph"?"hidden lg:flex":"flex"}`,children:[e.jsxs(Me,{shadows:!0,camera:{position:[-3.82,2.79,-4.95],fov:38},children:[e.jsx("color",{attach:"background",args:[z]}),e.jsx(ye,{preset:"city"}),e.jsx("ambientLight",{intensity:.6,color:"#ffffff"}),e.jsx("spotLight",{position:[10,10,5],angle:.3,penumbra:.5,intensity:2,castShadow:!0}),e.jsx("pointLight",{position:[-5,5,-3],intensity:.5,color:"#ffeedd"}),e.jsx("group",{position:[0,-1.2,0],children:e.jsxs("group",{position:[-.5,0,0],children:[e.jsxs("group",{rotation:[0,-Math.PI*.5,0],position:[-.01,-.84,.25],children:[e.jsx(Ie,{onHoverChange:x}),e.jsx("group",{position:[-.2,0,0],rotation:[0,-Math.PI/2,0],children:e.jsx(Ge,{onHoverChange:x})}),e.jsx("group",{position:[.3,.48,0],rotation:[0,-Math.PI/2,0],children:e.jsx(Xe,{contraction:b.currentContraction,temperature:c,onHoverChange:x,showLigature1:!!b.ligature1,isTight1:b.ligature1,showLigature2:!!b.ligature2,isTight2:b.ligature2})})]}),e.jsx(Ye,{contraction:b.currentContraction}),e.jsx(Ue,{angle:(3-b.currentContraction)*.036,onHoverChange:x}),o==="summation"&&e.jsx(Ke,{isPressed:b.isRecording&&(()=>{const r=te(c,o).periodMs,v=r*2,$=r*4,Y=b.time<150,D=b.time>v&&b.time<v+150,C=$-1300,V=$,X=b.time>C&&b.time<V&&b.time%250<100;return Y||D||X})(),onHoverChange:x}),e.jsx("group",{position:[4.395,.75,.05],children:e.jsx(qe,{simTime:b.time,waveformValue:b.currentContraction,isRecording:b.isRecording,onHoverChange:x,resetKey:m,drumSpeed:L})})]})}),e.jsx(we,{makeDefault:!0,target:[.2,-.36,-.44],minPolarAngle:0})]}),k&&e.jsx("div",{className:"absolute top-4 left-4 bg-slate-900/90 text-white px-3 py-1.5 rounded-full text-sm border border-slate-700 backdrop-blur-sm pointer-events-none animate-in fade-in duration-200",children:k})]}),e.jsxs("div",{className:"w-full lg:w-[450px] bg-slate-900 border-l border-slate-800 flex flex-col flex-1 lg:flex-none",children:[e.jsxs("div",{className:`flex-1 p-4 min-h-0 flex flex-col border-b border-slate-800 ${l==="3d"?"hidden lg:flex":"flex"}`,children:[e.jsx("h3",{className:"text-slate-400 text-sm font-bold uppercase tracking-wider mb-2",children:"Oscilloscope View"}),e.jsx("div",{className:"flex-1 bg-slate-950 rounded-lg border border-slate-800 overflow-hidden relative",children:e.jsx(He,{data:b.data,temperature:c,isRecording:b.isRecording,selectedExperiment:o,drumSpeed:L,heartRate:b.heartRate})})]}),e.jsxs("div",{className:"p-4 lg:p-6 bg-slate-900 z-10 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase flex items-center gap-2 mb-2",children:[e.jsx(ke,{className:"w-4 h-4 text-emerald-400"})," Select Experiment"]}),e.jsxs("select",{value:o,onChange:u=>{const r=u.target.value;p(r),H.current=[],Z.current=0,d({time:0,isRecording:!1,data:[],currentContraction:3,heartRate:te(c,r).hr,temperature:c}),w(v=>v+1),W.current&&cancelAnimationFrame(W.current)},className:"w-full bg-slate-800 border border-slate-700 text-slate-200 text-sm rounded-lg focus:ring-emerald-500 focus:border-emerald-500 block p-2.5 outline-none",children:[e.jsx("option",{value:"extra-systole",children:"1. Extra systole and compensatory pause"}),e.jsx("option",{value:"heart-block",children:"2. Heart block: Stannius ligatures"}),e.jsx("option",{value:"all-or-none",children:"3. All or none law"}),e.jsx("option",{value:"staircase",children:"4. Stair case phenomenon"}),e.jsx("option",{value:"summation",children:"5. Summation of subliminal stimuli"})]})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full animate-pulse bg-emerald-500"}),e.jsx("span",{className:"text-sm text-slate-300",children:"Heart Rate"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-mono font-bold text-emerald-400",children:[b.heartRate," bpm"]}),e.jsx("button",{onClick:()=>{S(),ee(u=>!u)},className:`p-1.5 rounded-lg transition-all border ${T?"bg-slate-700 border-slate-600 text-slate-500":"bg-red-900/40 border-red-700/50 text-red-400 hover:bg-red-900/60"}`,title:T?"Unmute heartbeat sound":"Mute heartbeat sound",children:T?e.jsx(Fe,{className:"w-4 h-4"}):e.jsx(Be,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex justify-between mb-1.5",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase flex items-center gap-1.5",children:[e.jsx(De,{className:"w-3.5 h-3.5 text-cyan-400"})," Drum Speed"]}),e.jsxs("span",{className:"text-cyan-400 font-mono text-sm",children:[L," mm/s"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:L,onChange:u=>h(Number(u.target.value)),disabled:o==="heart-block"||o==="all-or-none",className:`w-full h-2 rounded-lg appearance-none cursor-pointer accent-cyan-500 ${o==="heart-block"||o==="all-or-none"?"opacity-50 cursor-not-allowed bg-slate-700":"bg-slate-600"}`}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mt-1",children:[e.jsx("span",{children:"1 mm/s"}),e.jsx("span",{children:"10 mm/s"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[b.isRecording?e.jsxs("button",{onClick:ce,className:"flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2",children:[e.jsx(Ve,{className:"w-5 h-5"})," Stop"]}):e.jsxs("button",{onClick:_,className:"flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2",children:[e.jsx(ze,{className:"w-5 h-5"})," Start Recording"]}),e.jsxs("button",{onClick:K,className:"px-6 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold py-3 rounded-xl transition-all border border-slate-700 flex items-center justify-center gap-2",children:[e.jsx(ve,{className:"w-4 h-4"})," Reset"]})]})]})]})]})]})};export{et as PropertiesOfCardiacMuscle};
