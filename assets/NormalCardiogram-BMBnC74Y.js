import{r as o,j as e,A as ae,i as le,e as ie,d as ce,L as de,b as he,E as xe,O as ue,o as me,n as ge,B as M,C as b,S as A,p as U,a as je,u as z,Y as pe,z as T,$ as fe,m as V,V as h,T as B,a0 as be,a1 as J,h as Me,a2 as Se}from"./index-FleCPmMf.js";import{u as we,V as ve,a as ye,D as Ce,S as Re}from"./useHeartbeatSound-ZuqifI76.js";import{P as Ne}from"./play-ClWIrPCM.js";const D=[{label:"Cold (15°C)",value:15,hr:18,amplitude:1.3,color:"#3b82f6",bgColor:"bg-blue-600",borderColor:"border-blue-400"},{label:"Normal (25°C)",value:25,hr:24,amplitude:1,color:"#22c55e",bgColor:"bg-green-600",borderColor:"border-green-400"},{label:"Warm (35°C)",value:35,hr:36,amplitude:.7,color:"#ef4444",bgColor:"bg-red-600",borderColor:"border-red-400"}];function F(r){const s=D.find(d=>d.value===r)||D[1],t=60/s.hr*1e3;return{hr:s.hr,amplitude:s.amplitude,periodMs:t,color:s.color}}function Pe(r,s){const t=c=>(1-Math.cos(c*Math.PI))/2;let d;return r<.16?d=3-2*t(r/.16):r<.32?d=1+1*t((r-.16)/.16):r<.4?d=2:r<.56?d=2-2*t((r-.4)/.16):d=3*t((r-.56)/.44),d*s}const y=({label:r,children:s,onHoverChange:t})=>e.jsx("group",{onPointerOver:d=>{t&&(d.stopPropagation(),t(r),document.body.style.cursor="pointer")},onPointerOut:()=>{t&&(t(null),document.body.style.cursor="auto")},children:s}),Ee=({onHoverChange:r})=>e.jsx(y,{label:"Myograph Board",onHoverChange:r,children:e.jsxs("group",{position:[0,-.9,0],children:[e.jsx(M,{args:[4,.15,2.5],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#8B7355",roughness:.8})}),e.jsx(M,{args:[3.6,.05,2.1],position:[0,.1,0],children:e.jsx("meshStandardMaterial",{color:"#D2B48C",roughness:.9})}),[[-1.7,-.2,-1],[1.7,-.2,-1],[-1.7,-.2,1],[1.7,-.2,1]].map((s,t)=>e.jsx(b,{args:[.06,.08,.3],position:s,children:e.jsx("meshStandardMaterial",{color:"#5C4033",roughness:.7})},`leg-${t}`)),[[-1.2,.15,-.6],[-1.2,.15,.6],[1.2,.15,-.6],[1.2,.15,.6],[-.6,.15,-.8],[-.6,.15,.8],[.6,.15,-.8],[.6,.15,.8]].map((s,t)=>e.jsxs("group",{position:s,children:[e.jsx(b,{args:[.015,.015,.15],position:[0,.075,0],children:e.jsx("meshStandardMaterial",{color:"#c0c0c0",metalness:.9,roughness:.1})}),e.jsx(A,{args:[.02,8,8],position:[0,.15,0],children:e.jsx("meshStandardMaterial",{color:"#e0e0e0",metalness:.8,roughness:.2})})]},`pin-${t}`))]})}),Le=({contraction:r,temperature:s,onHoverChange:t})=>{const d=o.useRef(null),c=o.useRef(null),S=o.useRef(null),w=o.useRef(null),i=o.useRef(null),u=o.useMemo(()=>s<=15?"#8B0000":s>=35?"#FF4444":"#be123c",[s]),a=o.useMemo(()=>new je(u).multiplyScalar(.8).getHexString(),[u]);z(()=>{if(c.current){const R=3-r,f=Math.max(.4,1-R*.05),E=Math.max(.5,1-R*.05);c.current.scale.set(f,E,f)}if(S.current&&w.current&&(S.current.scale.set(1,1,1),w.current.scale.set(1,1,1)),i.current){const f=1+(3-r)*.05;i.current.scale.set(f,1,f)}});const n=o.useMemo(()=>{const R=new pe([new T(0,-.6),new T(.15,-.4),new T(.28,-.1),new T(.32,.2),new T(.25,.5),new T(.15,.6),new T(0,.65)]),f=new fe(R.getPoints(20),32);return f.computeVertexNormals(),f},[]),m=o.useMemo(()=>new V([new h(0,.6,.1),new h(0,.85,.15)]),[]),g=o.useMemo(()=>new V([new h(0,.85,.15),new h(-.25,1,.05),new h(-.4,1.05,-.1)]),[]),j=o.useMemo(()=>new V([new h(0,.85,.15),new h(.25,1,.05),new h(.4,1.05,-.1)]),[]),v=o.useMemo(()=>new V([new h(.25,.4,-.1),new h(.4,.6,-.15),new h(.45,.8,-.1)]),[]),C=o.useMemo(()=>new V([new h(.2,.35,.1),new h(.3,.2,.15),new h(.35,-.05,.1)]),[]);return e.jsx(y,{label:"Frog Heart (Sinus Venosus → Atria → Ventricle)",onHoverChange:t,children:e.jsxs("group",{ref:d,position:[0,-.2,0],rotation:[0,0,Math.PI],children:[e.jsxs("group",{position:[0,.55,0],children:[e.jsx("group",{ref:w,position:[.18,0,-.05],rotation:[0,0,-.2],children:e.jsx(y,{label:"Right Atrium",onHoverChange:t,children:e.jsx(A,{args:[.22,32,32],scale:[1,1.1,.9],children:e.jsx("meshPhysicalMaterial",{color:"#"+a,roughness:.4,metalness:.1,clearcoat:1,clearcoatRoughness:.2})})})}),e.jsx("group",{ref:S,position:[-.18,.05,-.05],rotation:[0,0,.2],children:e.jsx(y,{label:"Left Atrium",onHoverChange:t,children:e.jsx(A,{args:[.16,32,32],scale:[1,1.1,.9],children:e.jsx("meshPhysicalMaterial",{color:"#"+a,roughness:.4,metalness:.1,clearcoat:1,clearcoatRoughness:.2})})})})]}),e.jsx("group",{ref:c,position:[0,0,.05],children:e.jsx(y,{label:"Ventricle",onHoverChange:t,children:e.jsx("mesh",{geometry:n,children:e.jsx("meshPhysicalMaterial",{color:u,roughness:.5,metalness:.1,clearcoat:1,clearcoatRoughness:.3})})})}),e.jsx("group",{ref:i,children:e.jsxs(y,{label:"Truncus Arteriosus (Branching)",onHoverChange:t,children:[e.jsx(B,{args:[m,16,.06,12,!1],children:e.jsx("meshPhysicalMaterial",{color:"#d64949",roughness:.4,clearcoat:1})}),e.jsx(B,{args:[g,16,.045,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#d64949",roughness:.4,clearcoat:1})}),e.jsx(B,{args:[j,16,.045,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#d64949",roughness:.4,clearcoat:1})})]})}),e.jsxs(y,{label:"Vena Cavae",onHoverChange:t,children:[e.jsx(B,{args:[v,12,.035,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#5e4b8b",roughness:.6})}),e.jsx(B,{args:[C,12,.035,8,!1],children:e.jsx("meshPhysicalMaterial",{color:"#5e4b8b",roughness:.6})})]}),e.jsx(y,{label:"Sinus Venosus (Posterior)",onHoverChange:t,children:e.jsx(A,{args:[.2,16,16],position:[0,.4,-.2],scale:[1.2,.8,.5],children:e.jsx("meshPhysicalMaterial",{color:"#4a2c2c",roughness:.8})})})]})})},Ae=({onHoverChange:r})=>e.jsx(y,{label:"Frog (Pithed)",onHoverChange:r,children:e.jsxs("group",{position:[0,-.4,.2],rotation:[-.1,0,0],children:[e.jsx(A,{args:[.5,32,32],scale:[2.2,1,3],position:[0,0,0],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsxs("group",{position:[0,.45,-.5],rotation:[.1,0,0],children:[e.jsx(U,{args:[.28,.05,16,24],rotation:[Math.PI/2,0,0],scale:[1,1,1.2],position:[0,.02,0],children:e.jsx("meshStandardMaterial",{color:"#661111",roughness:.5})}),e.jsxs("group",{position:[-.4,.02,0],rotation:[0,0,.3],children:[e.jsx(M,{args:[.3,.03,.6],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(M,{args:[.28,.031,.58],position:[.05,-.005,0],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]}),e.jsxs("group",{position:[.4,.02,0],rotation:[0,0,-.3],children:[e.jsx(M,{args:[.3,.03,.6],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(M,{args:[.28,.031,.58],position:[-.05,-.005,0],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]}),e.jsxs("group",{position:[0,.05,-.4],rotation:[.4,0,0],children:[e.jsx(M,{args:[.5,.03,.25],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(M,{args:[.48,.031,.23],position:[0,-.005,.05],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]}),e.jsxs("group",{position:[0,.05,.4],rotation:[-.4,0,0],children:[e.jsx(M,{args:[.5,.03,.25],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(M,{args:[.48,.031,.23],position:[0,-.005,-.05],children:e.jsx("meshStandardMaterial",{color:"#4a1c1c",roughness:.7})})]})]}),e.jsxs("group",{position:[0,.1,-1.6],children:[e.jsx(A,{args:[.4,32,32],scale:[1.5,.8,1.2],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})}),e.jsx(A,{args:[.1,16,16],position:[.3,.2,-.1],children:e.jsx("meshStandardMaterial",{color:"#111",roughness:.2})}),e.jsx(A,{args:[.1,16,16],position:[-.3,.2,-.1],children:e.jsx("meshStandardMaterial",{color:"#111",roughness:.2})})]}),e.jsx("group",{position:[.9,-.1,1],rotation:[0,.5,0],children:e.jsx(b,{args:[.2,.15,1.2],rotation:[0,0,1.2],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})})}),e.jsx("group",{position:[-.9,-.1,1],rotation:[0,-.5,0],children:e.jsx(b,{args:[.2,.15,1.2],rotation:[0,0,-1.2],children:e.jsx("meshStandardMaterial",{color:"#556b2f",roughness:.6})})}),e.jsx("group",{position:[.8,-.1,-.8],rotation:[0,-.3,0],children:e.jsx(b,{args:[.12,.1,1],rotation:[0,0,1.3],children:e.jsx("meshStandardMaterial",{color:"#8da399",roughness:.8})})}),e.jsx("group",{position:[-.8,-.1,-.8],rotation:[0,.3,0],children:e.jsx(b,{args:[.12,.1,1],rotation:[0,0,-1.3],children:e.jsx("meshStandardMaterial",{color:"#8da399",roughness:.8})})})]})}),ke=({length:r,radius:s,coils:t,color:d,thickness:c})=>{const w=o.useMemo(()=>{const i=[],u=t*12;for(let n=0;n<=u;n++){const m=n/u,g=m*Math.PI*2*t,j=s*Math.cos(g),v=s*Math.sin(g),C=-m*1;i.push(new h(j,C,v))}const a=new V(i);return new Se(a,u,c,8,!1)},[s,t,c]);return e.jsx("group",{scale:[1,r/1,1],children:e.jsx("mesh",{geometry:w,children:e.jsx("meshStandardMaterial",{color:d,metalness:.6,roughness:.4})})})},Te=({angle:r,onHoverChange:s})=>{const t="#e2e8f0",d="#94a3b8",c="#475569",S="#f1f5f9",u=[-1.5,.7,.15],a=-r,m=.75+r*.9,g=[.6,0,0];return e.jsxs("group",{position:[0,.5,.5],children:[e.jsx(y,{label:"Starling Lever (Stand Post)",onHoverChange:s,children:e.jsx(b,{args:[.06,.06,4.5],position:[-1.5,0,0],children:e.jsx("meshStandardMaterial",{color:d,metalness:.6,roughness:.4})})}),e.jsx(y,{label:"Starling Lever (Tension Adjuster)",onHoverChange:s,children:e.jsxs("group",{position:[-.75,.4,0],rotation:[0,0,1.57],children:[e.jsx(b,{args:[.025,.025,1],position:[.8,.05,0],rotation:[0,0,Math.PI/2],children:e.jsx("meshStandardMaterial",{color:t,metalness:.6})}),e.jsxs("group",{position:[1.1,.05,0],children:[e.jsx(M,{args:[.1,.15,.1],children:e.jsx("meshStandardMaterial",{color:t})}),e.jsx(b,{args:[.015,.015,.6],position:[0,-.17,0],children:e.jsx("meshStandardMaterial",{color:t,metalness:.5})}),e.jsx(b,{args:[.05,.05,.04],position:[0,.13,0],children:e.jsx("meshStandardMaterial",{color:c,roughness:.8})}),e.jsx(U,{args:[.025,.005,8,16],position:[0,-.47,0],rotation:[Math.PI/2,0,0],children:e.jsx("meshStandardMaterial",{color:t})})]})]})}),e.jsxs("group",{position:u,children:[e.jsxs("group",{position:[.3,0,-.14],children:[e.jsx(y,{label:"Starling Lever (Mounting Clamp)",onHoverChange:s,children:e.jsxs("group",{children:[e.jsx(M,{args:[.85,.13,.4],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})}),e.jsxs("group",{position:[-.5,0,0],rotation:[0,0,Math.PI/2],children:[e.jsx(b,{args:[.03,.03,.1],children:e.jsx("meshStandardMaterial",{color:c})}),e.jsx(b,{args:[.07,.07,.02],position:[0,.05,0],children:e.jsx("meshStandardMaterial",{color:c})})]})]})}),e.jsxs("group",{position:[.55,0,0],children:[e.jsx(M,{args:[.05,.13,.35],position:[-.1,0,0],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})}),e.jsx(M,{args:[.25,.13,.04],position:[0,0,.18],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})}),e.jsx(M,{args:[.25,.13,.04],position:[0,0,-.18],children:e.jsx("meshStandardMaterial",{color:t,metalness:.7})})]}),e.jsxs("group",{rotation:[0,0,a],position:g,children:[e.jsx(b,{args:[.02,.02,.35],rotation:[Math.PI/2,0,0],children:e.jsx("meshStandardMaterial",{color:c})}),e.jsx(y,{label:"Starling Lever (Lever Arm)",onHoverChange:s,children:e.jsxs("group",{position:[.5,0,0],children:[e.jsx(M,{args:[1.2,.12,.03],children:e.jsx("meshStandardMaterial",{color:S,roughness:.3,metalness:.2})}),[-.4,-.2,0,.2,.4].map((j,v)=>e.jsx("group",{position:[j,0,0],rotation:[Math.PI/2,0,0],children:e.jsx(b,{args:[.025,.025,.032],children:e.jsx("meshBasicMaterial",{color:"#1e293b"})})},v))]})}),e.jsx(y,{label:"Starling Lever (Writing Stylus)",onHoverChange:s,children:e.jsxs("group",{position:[1.18,0,0],children:[e.jsx(M,{args:[.08,.08,.08],position:[-.04,0,0],children:e.jsx("meshStandardMaterial",{color:t})}),e.jsx(b,{args:[.012,.012,2.9],position:[1.45,0,0],rotation:[0,0,Math.PI/2],children:e.jsx("meshStandardMaterial",{color:"#222",roughness:.6})}),e.jsx(J,{args:[.012,.06,8],position:[2.9,0,0],rotation:[0,0,-Math.PI/2],children:e.jsx("meshStandardMaterial",{color:"#111"})})]})})]})]}),e.jsx(y,{label:"Starling Lever (Spring)",onHoverChange:s,children:e.jsx("group",{position:[1.15,.8,-.15],children:e.jsx(ke,{length:m,radius:.04,coils:14,color:"#cbd5e1",thickness:.01})})})]})]})},Ve=({contraction:r})=>{const{start:t,end:d,len:c,midpoint:S,quaternion:w}=o.useMemo(()=>{const g=-((3-r)*.036),j=1.16+Math.sin(g)*1,v=new h(0,.06-(3-r)*.03,0),C=new h(0,j,0),R=v.distanceTo(C),f=new h().addVectors(v,C).multiplyScalar(.5),E=new h(0,1,0),p=new h().subVectors(C,v).normalize(),N=new be().setFromUnitVectors(E,p);return{start:v,end:C,len:R,midpoint:f,quaternion:N}},[r]),i=o.useMemo(()=>new V([new h(0,-.015,0),new h(0,-.12,0),new h(-.01,-.14,0),new h(-.04,-.14,0),new h(-.05,-.1,0)]),[]);return e.jsxs("group",{position:[0,.1,.5],children:[e.jsxs("mesh",{position:S,quaternion:w,scale:[1,c,1],children:[e.jsx("cylinderGeometry",{args:[.003,.003,1,8]}),e.jsx("meshStandardMaterial",{color:"#f0f0f0",roughness:.5})]}),e.jsxs("group",{position:t,rotation:[0,0,.1],children:[e.jsx(U,{args:[.015,.003,8,16],rotation:[0,Math.PI/2,0],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})}),e.jsx(B,{args:[i,32,.003,8,!1],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})}),e.jsx(b,{args:[.001,.003,.02],position:[-.052,-.09,0],rotation:[0,0,-.2],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})}),e.jsx(J,{args:[.002,.01,8],position:[-.052,-.1,0],rotation:[0,0,2.8],children:e.jsx("meshStandardMaterial",{color:"#888",metalness:.8,roughness:.2})})]})]})},De=({simTime:r,waveformValue:s,isRecording:t,onHoverChange:d,resetKey:c,drumSpeed:S})=>{const w=o.useRef(document.createElement("canvas")),i=o.useRef(null),u=o.useMemo(()=>{const n=w.current;n.width=2048,n.height=512;const m=n.getContext("2d");if(m){m.fillStyle="#1a1a1a",m.fillRect(0,0,2048,512),m.fillStyle="#0d0d0d";for(let g=0;g<200;g++)m.fillRect(Math.random()*2048,Math.random()*512,Math.random()*4,Math.random()*4)}return new Me(n)},[]);o.useEffect(()=>{const n=w.current.getContext("2d");if(n){n.fillStyle="#1a1a1a",n.fillRect(0,0,2048,512),n.fillStyle="#0d0d0d";for(let m=0;m<200;m++)n.fillRect(Math.random()*2048,Math.random()*512,Math.random()*4,Math.random()*4);u.needsUpdate=!0}i.current=null},[c,u]),z(()=>{if(!t){i.current=null;return}const n=w.current.getContext("2d");if(!n)return;const g=80+r/1e3*S*15,j=512*.5-s*30;i.current&&(n.strokeStyle="#ffffff",n.lineWidth=2.5,n.shadowColor="#ffffff",n.shadowBlur=1,n.beginPath(),n.moveTo(i.current.x,i.current.y),n.lineTo(g,j),n.stroke(),n.shadowBlur=0,u.needsUpdate=!0),i.current={x:g,y:j}});const a=o.useRef(null);return z(()=>{if(a.current&&t){const g=(80+r/1e3*S*15-80)/2048*(2*Math.PI),j=1.8+Math.PI;a.current.rotation.y=j-g}}),e.jsx(y,{label:"Kymograph Drum",onHoverChange:d,children:e.jsxs("group",{position:[0,0,0],children:[e.jsx("group",{ref:a,rotation:[0,1.8+Math.PI,0],children:e.jsxs(b,{args:[1,1,2.5,64],children:[e.jsx("meshBasicMaterial",{attach:"material-0",map:u}),e.jsx("meshStandardMaterial",{attach:"material-1",color:"#111"}),e.jsx("meshStandardMaterial",{attach:"material-2",color:"#111"})]})}),e.jsx(b,{args:[.06,.06,3.5],position:[0,-.15,0],children:e.jsx("meshStandardMaterial",{color:"#1e293b",metalness:.8})}),e.jsx(M,{args:[1.2,.45,1.5],position:[0,-1.75,0],children:e.jsx("meshStandardMaterial",{color:"#0f172a",metalness:.3,roughness:.6})})]})})},Ie=({data:r,temperature:s,isRecording:t})=>{D.find(x=>x.value===s)||D[1];const d="#4ade80",c="#14532d",S="#166534",w="#020617",i=900,u=320,a={top:30,right:20,bottom:40,left:40},n=i-a.left-a.right,m=u-a.top-a.bottom,g=-.5,j=3.5,v=x=>a.top+m-(x-g)/(j-g)*m,C=24e3,R=r.length>0?r[r.length-1].t:0,f=Math.max(0,R-C),E=Math.max(C,R+200),p=x=>a.left+(x-f)/(E-f)*n,N=r.filter(x=>x.t>=f-500),P=N.length>1?`M ${N.map(x=>`${p(x.t)},${v(x.y)}`).join(" L ")}`:"",$=[],I=Math.ceil(f/500)*500;for(let x=I;x<=E;x+=500)$.push(x);const O=[0,1,2,3];return e.jsxs("svg",{viewBox:`0 0 ${i} ${u}`,className:"w-full h-full",preserveAspectRatio:"xMidYMid meet",children:[e.jsx("rect",{x:0,y:0,width:i,height:u,fill:w,rx:8}),e.jsx("pattern",{id:"scanlines",patternUnits:"userSpaceOnUse",width:"4",height:"4",children:e.jsx("line",{x1:"0",y1:"0",x2:"4",y2:"0",stroke:"#000",strokeOpacity:"0.2",strokeWidth:"1"})}),e.jsx("rect",{x:0,y:0,width:i,height:u,fill:"url(#scanlines)",pointerEvents:"none"}),O.map((x,L)=>e.jsx("line",{x1:a.left,y1:v(x),x2:i-a.right,y2:v(x),stroke:x===0?S:c,strokeWidth:1},`hgrid-${L}`)),$.map((x,L)=>e.jsx("line",{x1:p(x),y1:a.top,x2:p(x),y2:u-a.bottom,stroke:x%1e3===0?S:c,strokeWidth:1},`tmark-${L}`)),e.jsx("defs",{children:e.jsxs("filter",{id:"oscilloscopeGlow",x:"-50%",y:"-50%",width:"200%",height:"200%",children:[e.jsx("feGaussianBlur",{stdDeviation:"2",result:"blur"}),e.jsx("feComposite",{in:"SourceGraphic",in2:"blur",operator:"over"})]})}),e.jsx("path",{d:P,fill:"none",stroke:d,strokeWidth:2,filter:"url(#oscilloscopeGlow)"}),e.jsxs("text",{x:i-a.right-10,y:a.top+20,textAnchor:"end",fill:d,fontSize:14,fontFamily:"monospace",fontWeight:"bold",children:["HR: ",F(s).hr," BPM"]}),e.jsxs("text",{x:i-a.right-10,y:a.top+40,textAnchor:"end",fill:S,fontSize:12,fontFamily:"monospace",children:["T: ",s,"°C"]}),t&&e.jsx("text",{x:a.left+10,y:a.top+20,fill:"#ef4444",fontSize:14,fontFamily:"monospace",fontWeight:"bold",children:"● REC"})]})},We=({onBack:r})=>{var Y,K;const[s,t]=o.useState(25),[d,c]=o.useState(null),[S,w]=o.useState(0),[i,u]=o.useState(2.5),[a,n]=o.useState("3d"),[m,g]=o.useState(!1),[j,v]=o.useState(!1),[C,R]=o.useState(0),[f,E]=o.useState("#CBD5E1"),[p,N]=o.useState({time:0,isRecording:!1,data:[],currentContraction:3,heartRate:24,temperature:25}),P=o.useRef(),$=o.useRef(0),I=o.useRef([]),O=15e3,x=20,L=o.useRef(0),q=o.useRef(s),{ensureAudioContext:X}=we({isRecording:p.isRecording,phase:C,volume:1,muted:j});o.useEffect(()=>{q.current=s},[s]);const ee=l=>{t(l),g(!0),setTimeout(()=>g(!1),2e3)},se=()=>{p.isRecording||(X(),I.current=[],L.current=0,N({time:0,isRecording:!0,data:[],currentContraction:3,heartRate:F(s).hr,temperature:s}),w(l=>l+1),$.current=0)},te=()=>{N(l=>({...l,isRecording:!1})),P.current&&cancelAnimationFrame(P.current)},re=()=>{I.current=[],L.current=0,N({time:0,isRecording:!1,data:[],currentContraction:3,heartRate:F(s).hr,temperature:s}),w(l=>l+1),P.current&&cancelAnimationFrame(P.current)};return o.useEffect(()=>{if(!p.isRecording){N(W=>({...W,heartRate:F(s).hr}));return}let l=Date.now(),k=0;$.current=Date.now();const H=()=>{const W=Date.now(),oe=W-l;if(l=W,k+=oe,k>O){N(_=>({..._,isRecording:!1}));return}const G=F(q.current),Z=k%G.periodMs/G.periodMs,Q=Pe(Z,G.amplitude),ne=Math.max(0,Q);R(Z),k-L.current>=x&&(L.current=k,I.current.push({t:k,y:Q})),N(_=>({..._,time:k,currentContraction:ne,heartRate:G.hr,data:I.current})),P.current=requestAnimationFrame(H)};return P.current=requestAnimationFrame(H),()=>{P.current&&cancelAnimationFrame(P.current)}},[p.isRecording]),e.jsxs("div",{className:"flex flex-col h-screen bg-slate-950 text-slate-100 font-sans relative",children:[e.jsxs("header",{className:"flex items-center justify-between px-6 py-4 bg-slate-900 border-b border-slate-800",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("button",{onClick:r,className:"p-2 hover:bg-slate-800 rounded-lg text-slate-400",children:e.jsx(ae,{className:"w-5 h-5"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-xl font-bold bg-gradient-to-r from-red-400 to-pink-500 bg-clip-text text-transparent",children:"Normal Cardiogram"}),e.jsx("p",{className:"text-slate-400 text-xs",children:"Amphibian / Frog Heart — Effect of Temperature"})]})]}),e.jsx("button",{onClick:()=>E(l=>l==="#CBD5E1"?"#2F3E46":"#CBD5E1"),className:"p-2 bg-slate-800 hover:bg-slate-700 rounded-lg text-slate-300 border border-slate-700 transition-colors flex items-center justify-center",title:"Toggle Canvas Background",children:f==="#CBD5E1"?e.jsx(le,{className:"w-5 h-5"}):e.jsx(ie,{className:"w-5 h-5"})})]}),e.jsxs("main",{className:"flex-1 flex flex-col lg:flex-row overflow-hidden",children:[e.jsxs("div",{className:"lg:hidden flex bg-slate-800 border-b border-slate-700",children:[e.jsxs("button",{onClick:()=>n("3d"),className:`flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium transition-all ${a==="3d"?"bg-slate-900 text-red-400 border-b-2 border-red-400":"text-slate-400 hover:text-slate-200"}`,children:[e.jsx(ce,{className:"w-4 h-4"}),e.jsx("span",{children:"3D View"})]}),e.jsxs("button",{onClick:()=>n("graph"),className:`flex-1 py-3 px-4 flex items-center justify-center gap-2 font-medium transition-all ${a==="graph"?"bg-slate-900 text-red-400 border-b-2 border-red-400":"text-slate-400 hover:text-slate-200"}`,children:[e.jsx(de,{className:"w-4 h-4"}),e.jsx("span",{children:"Cardiogram"})]})]}),e.jsxs("div",{className:`flex-1 relative bg-black ${a==="graph"?"hidden lg:flex":"flex"}`,children:[e.jsxs(he,{shadows:!0,camera:{position:[-3.82,2.79,-4.95],fov:38},children:[e.jsx("color",{attach:"background",args:[f]}),e.jsx(xe,{preset:"city"}),e.jsx("ambientLight",{intensity:.6,color:"#ffffff"}),e.jsx("spotLight",{position:[10,10,5],angle:.3,penumbra:.5,intensity:2,castShadow:!0}),e.jsx("pointLight",{position:[-5,5,-3],intensity:.5,color:"#ffeedd"}),e.jsx("group",{position:[0,-1.2,0],children:e.jsxs("group",{position:[-.5,0,0],children:[e.jsxs("group",{rotation:[0,-Math.PI*.5,0],position:[-.01,-.84,.25],children:[e.jsx(Ee,{onHoverChange:c}),e.jsx("group",{position:[-.2,0,0],rotation:[0,-Math.PI/2,0],children:e.jsx(Ae,{onHoverChange:c})}),e.jsx("group",{position:[.3,.48,0],rotation:[0,-Math.PI/2,0],children:e.jsx(Le,{contraction:p.currentContraction,temperature:s,onHoverChange:c})})]}),e.jsx(Ve,{contraction:p.currentContraction}),e.jsx(Te,{angle:(3-p.currentContraction)*.036,onHoverChange:c}),e.jsx("group",{position:[4.395,.75,.05],children:e.jsx(De,{simTime:p.time,waveformValue:p.currentContraction,isRecording:p.isRecording,onHoverChange:c,resetKey:S,drumSpeed:i})})]})}),e.jsx(ue,{makeDefault:!0,target:[.2,-.36,-.44],minPolarAngle:0})]}),d&&e.jsx("div",{className:"absolute top-4 left-4 bg-slate-900/90 text-white px-3 py-1.5 rounded-full text-sm border border-slate-700 backdrop-blur-sm pointer-events-none animate-in fade-in duration-200",children:d})]}),e.jsxs("div",{className:"w-full lg:w-[450px] bg-slate-900 border-l border-slate-800 flex flex-col flex-1 lg:flex-none",children:[e.jsxs("div",{className:`flex-1 p-4 min-h-0 flex flex-col border-b border-slate-800 ${a==="3d"?"hidden lg:flex":"flex"}`,children:[e.jsx("h3",{className:"text-slate-400 text-sm font-bold uppercase tracking-wider mb-2",children:"Oscilloscope View"}),e.jsx("div",{className:"flex-1 bg-slate-950 rounded-lg border border-slate-800 overflow-hidden relative",children:e.jsx(Ie,{data:p.data,temperature:s,isRecording:p.isRecording})})]}),e.jsxs("div",{className:"p-4 lg:p-6 bg-slate-900 z-10 space-y-4 overflow-y-auto",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase flex items-center gap-2 mb-2",children:[e.jsx(me,{className:"w-4 h-4 text-red-400"})," Ringer's Solution Temperature"]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:D.map(l=>e.jsxs("button",{onClick:()=>ee(l.value),className:`px-2 py-2.5 rounded-lg text-xs font-bold transition-all border text-center
                                            ${s===l.value?`${l.bgColor} ${l.borderColor} text-white shadow-lg`:"bg-slate-800 border-slate-700 text-slate-400 hover:bg-slate-700"}`,children:[e.jsxs("div",{children:[l.value,"°C"]}),e.jsx("div",{className:"text-[10px] opacity-75 mt-0.5",children:l.value<=15?"Cold":l.value>=35?"Warm":"Normal"})]},l.value))})]}),e.jsxs("div",{className:"bg-slate-800 rounded-lg border border-slate-700 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full animate-pulse",style:{backgroundColor:((Y=D.find(l=>l.value===s))==null?void 0:Y.color)||"#22c55e"}}),e.jsx("span",{className:"text-sm text-slate-300",children:"Heart Rate"})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:"text-lg font-mono font-bold",style:{color:((K=D.find(l=>l.value===s))==null?void 0:K.color)||"#22c55e"},children:[F(s).hr," bpm"]}),e.jsx("button",{onClick:()=>{X(),v(l=>!l)},className:`p-1.5 rounded-lg transition-all border ${j?"bg-slate-700 border-slate-600 text-slate-500":"bg-red-900/40 border-red-700/50 text-red-400 hover:bg-red-900/60"}`,title:j?"Unmute heartbeat sound":"Mute heartbeat sound",children:j?e.jsx(ve,{className:"w-4 h-4"}):e.jsx(ye,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"bg-slate-800 p-3 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex justify-between mb-1.5",children:[e.jsxs("label",{className:"text-xs font-bold text-slate-400 uppercase flex items-center gap-1.5",children:[e.jsx(Ce,{className:"w-3.5 h-3.5 text-cyan-400"})," Drum Speed"]}),e.jsxs("span",{className:"text-cyan-400 font-mono text-sm",children:[i," mm/s"]})]}),e.jsx("input",{type:"range",min:"1",max:"10",step:"0.5",value:i,onChange:l=>u(Number(l.target.value)),className:"w-full h-2 bg-slate-600 rounded-lg appearance-none cursor-pointer accent-cyan-500"}),e.jsxs("div",{className:"flex justify-between text-[10px] text-slate-500 mt-1",children:[e.jsx("span",{children:"1 mm/s"}),e.jsx("span",{children:"10 mm/s"})]})]}),e.jsxs("div",{className:"flex gap-3",children:[p.isRecording?e.jsxs("button",{onClick:te,className:"flex-1 bg-slate-700 hover:bg-slate-600 text-white font-bold py-3 rounded-xl transition-all flex items-center justify-center gap-2",children:[e.jsx(Re,{className:"w-5 h-5"})," Stop"]}):e.jsxs("button",{onClick:se,className:"flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-xl shadow-lg transition-all flex items-center justify-center gap-2",children:[e.jsx(Ne,{className:"w-5 h-5"})," Start Recording"]}),e.jsxs("button",{onClick:re,className:"px-6 bg-slate-800 hover:bg-slate-700 text-slate-300 font-bold py-3 rounded-xl transition-all border border-slate-700 flex items-center justify-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4"})," Reset"]})]})]})]})]})]})};export{We as NormalCardiogram};
